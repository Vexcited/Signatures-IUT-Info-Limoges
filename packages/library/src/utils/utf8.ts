"use strict";

/**
 * Object containing Latin-1 characters and their corresponding UTF-8 characters.
 * Key is the actual character, value is the expected character.
 */
const replacements: Record<string, string> = {
  "â‚¬": "€",
  "Å’": "Œ",
  "Å½": "Ž",
  "â€œ": "“",
  "â€\u009D": "”",
  "â€¢": "•",
  "â€“": "–",
  "â€”": "—",
  Ëœ: "˜",
  "â„¢": "™",
  "Å¡": "š",
  "â€º": "›",
  "Å“": "œ",
  "Å¾": "ž",
  "Å¸": "Ÿ",
  "Â ": " ",
  "Â¡": "¡",
  "Â¢": "¢",
  "Â£": "£",
  "Â¤": "¤",
  "Â¥": "¥",
  "Â¦": "¦",
  "Â§": "§",
  "Â¨": "¨",
  "Â©": "©",
  "Â­": "­",
  "Â®": "®",
  "Â¯": "¯",
  "Â°": "°",
  "Â±": "±",
  "Â²": "²",
  "Â³": "³",
  "Â´": "´",
  Âµ: "µ",
  "Â¶": "¶",
  "Â·": "·",
  "Â¸": "¸",
  "Â¹": "¹",
  Âº: "º",
  "Â»": "»",
  "Â¼": "¼",
  "Â½": "½",
  "Â¾": "¾",
  "Â¿": "¿",
  "Ã€": "À",
  "Ã‚": "Â",
  Ãƒ: "Ã",
  "Ã„": "Ä",
  "Ã…": "Å",
  "Ã†": "Æ",
  "Ã‡": "Ç",
  Ãˆ: "È",
  "Ã‰": "É",
  ÃŠ: "Ê",
  "Ã‹": "Ë",
  ÃŒ: "Ì",
  "Ã\u008D": "Í",
  ÃŽ: "Î",
  "Ã\u008F": "Ï",
  "Ã\u0090": "Ð",
  "Ã‘": "Ñ",
  "Ã’": "Ò",
  "Ã“": "Ó",
  "Ã”": "Ô",
  "Ã•": "Õ",
  "Ã–": "Ö",
  "Ã—": "×",
  "Ã˜": "Ø",
  "Ã™": "Ù",
  Ãš: "Ú",
  "Ã›": "Û",
  Ãœ: "Ü",
  "Ã\u009D": "Ý",
  Ãž: "Þ",
  ÃŸ: "ß",
  "Ã\u00A0": "à",
  "Ã¡": "á",
  "Ã¢": "â",
  "Ã£": "ã",
  "Ã¤": "ä",
  "Ã¥": "å",
  "Ã¦": "æ",
  "Ã§": "ç",
  "Ã¨": "è",
  "Ã©": "é",
  Ãª: "ê",
  "Ã«": "ë",
  "Ã¬": "ì",
  "Ã\u00AD": "í",
  "Ã®": "î",
  "Ã¯": "ï",
  "Ã°": "ð",
  "Ã±": "ñ",
  "Ã²": "ò",
  "Ã³": "ó",
  "Ã´": "ô",
  Ãµ: "õ",
  "Ã¶": "ö",
  "Ã·": "÷",
  "Ã¸": "ø",
  "Ã¹": "ù",
  Ãº: "ú",
  "Ã»": "û",
  "Ã¼": "ü",
  "Ã½": "ý",
  "Ã¾": "þ",
  "Ã¿": "ÿ",
  "½": "œ"
};

// Cache immutable regex as they are expensive to create and garbage collect.
const matchRegex = new RegExp(Object.keys(replacements).join("|"), "gu");

/**
 * @author Frazer Smith
 * @description Fixes common encoding errors when converting from Latin-1 (and Windows-1252) to UTF-8.
 * @see {@link http://www.i18nqa.com/debug/utf8-debug.html | UTF-8 Encoding Debugging Chart}
 * @see {@link https://github.com/Fdawgs/fix-latin1-to-utf8/blob/main/src/index.js | Original source}
 */
function fixLatin1ToUtf8 (str: string): string {
  return str.replace(matchRegex, (match) => replacements[match]).normalize();
}

export default fixLatin1ToUtf8;
